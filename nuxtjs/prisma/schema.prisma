generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
}

model click_event {
  id               BigInt   @id @default(autoincrement()) @db.UnsignedBigInt
  user_id          BigInt?  @db.UnsignedBigInt
  event_type       String   @db.VarChar(50)
  element_id       String?  @db.VarChar(200)
  element_type     String?  @db.VarChar(50)
  page_path        String   @db.VarChar(500)
  click_position_x Int?     @db.UnsignedInt
  click_position_y Int?     @db.UnsignedInt
  related_id       BigInt?  @db.UnsignedBigInt
  related_type     String?  @db.VarChar(50)
  ip_address       String?  @db.VarChar(50)
  created_at       DateTime @default(now())
  user             user?    @relation(fields: [user_id], references: [id])

  @@index([created_at])
  @@index([event_type])
  @@index([page_path])
  @@index([user_id])
}

model coin_transaction {
  id           BigInt                @id @default(autoincrement()) @db.UnsignedBigInt
  user_id      BigInt                @db.UnsignedBigInt
  type         coin_transaction_type
  amount       Decimal               @db.Decimal(10, 2)
  balance      Decimal               @db.Decimal(10, 2)
  description  String?               @db.VarChar(500)
  related_id   BigInt?               @db.UnsignedBigInt
  related_type String?               @db.VarChar(50)
  created_at   DateTime              @default(now())
  user         user                  @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([created_at])
  @@index([type])
  @@index([user_id])
}

model comment {
  id            BigInt         @id @default(autoincrement()) @db.UnsignedBigInt
  post_id       BigInt         @db.UnsignedBigInt
  user_id       BigInt         @db.UnsignedBigInt
  content       String         @db.Text
  parent_id     BigInt?        @db.UnsignedBigInt
  like_count    Int            @default(0) @db.UnsignedInt
  status        comment_status @default(active)
  created_at    DateTime       @default(now())
  updated_at    DateTime
  comment       comment?       @relation("commentTocomment", fields: [parent_id], references: [id], onDelete: Cascade)
  other_comment comment[]      @relation("commentTocomment")
  post          post           @relation(fields: [post_id], references: [id], onDelete: Cascade)
  user          user           @relation(fields: [user_id], references: [id], onDelete: Cascade)
  comment_like  comment_like[]

  @@index([created_at])
  @@index([parent_id])
  @@index([post_id])
  @@index([user_id])
}

model comment_like {
  id         BigInt   @id @default(autoincrement()) @db.UnsignedBigInt
  user_id    BigInt   @db.UnsignedBigInt
  comment_id BigInt   @db.UnsignedBigInt
  created_at DateTime @default(now())
  comment    comment  @relation(fields: [comment_id], references: [id], onDelete: Cascade)
  user       user     @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([user_id, comment_id])
  @@index([comment_id])
  @@index([user_id])
}

model creator_application {
  id                                         BigInt                     @id @default(autoincrement()) @db.UnsignedBigInt
  user_id                                    BigInt                     @unique @db.UnsignedBigInt
  real_name                                  String?                    @db.VarChar(50)
  id_card                                    String?                    @db.VarChar(50)
  phone                                      String?                    @db.VarChar(20)
  email                                      String?                    @db.VarChar(100)
  bio                                        String?                    @db.Text
  qualification_urls                         Json?
  status                                     creator_application_status @default(pending)
  reject_reason                              String?                    @db.Text
  reviewed_by                                BigInt?                    @db.UnsignedBigInt
  reviewed_at                                DateTime?
  created_at                                 DateTime                   @default(now())
  updated_at                                 DateTime
  user_creator_application_reviewed_byTouser user?                      @relation("creator_application_reviewed_byTouser", fields: [reviewed_by], references: [id])
  user_creator_application_user_idTouser     user                       @relation("creator_application_user_idTouser", fields: [user_id], references: [id], onDelete: Cascade)

  @@index([created_at])
  @@index([reviewed_by], map: "creator_application_reviewed_by_fkey")
  @@index([status])
  @@index([user_id])
}

model follow {
  id                             BigInt   @id @default(autoincrement()) @db.UnsignedBigInt
  follower_id                    BigInt   @db.UnsignedBigInt
  following_id                   BigInt   @db.UnsignedBigInt
  created_at                     DateTime @default(now())
  user_follow_follower_idTouser  user     @relation("follow_follower_idTouser", fields: [follower_id], references: [id], onDelete: Cascade)
  user_follow_following_idTouser user     @relation("follow_following_idTouser", fields: [following_id], references: [id], onDelete: Cascade)

  @@unique([follower_id, following_id])
  @@index([follower_id])
  @@index([following_id])
}

model island {
  id            BigInt          @id @default(autoincrement()) @db.UnsignedBigInt
  name          String          @db.VarChar(100)
  description   String?         @db.Text
  cover         String?         @db.VarChar(500)
  avatar        String?         @db.VarChar(500)
  category      String          @db.VarChar(50)
  owner_id      BigInt          @db.UnsignedBigInt
  price         Decimal         @default(0.00) @db.Decimal(10, 2)
  member_count  Int             @default(0) @db.UnsignedInt
  post_count    Int             @default(0) @db.UnsignedInt
  status        island_status   @default(pending)
  is_verified   Boolean         @default(false)
  created_at    DateTime        @default(now())
  updated_at    DateTime
  user          user            @relation(fields: [owner_id], references: [id], onDelete: Cascade)
  island_member island_member[]
  post          post[]

  @@index([category])
  @@index([created_at])
  @@index([owner_id])
  @@index([status])
}

model island_member {
  id          BigInt                  @id @default(autoincrement()) @db.UnsignedBigInt
  user_id     BigInt                  @db.UnsignedBigInt
  island_id   BigInt                  @db.UnsignedBigInt
  join_type   island_member_join_type @default(free)
  paid_amount Decimal                 @default(0.00) @db.Decimal(10, 2)
  created_at  DateTime                @default(now())
  updated_at  DateTime
  island      island                  @relation(fields: [island_id], references: [id], onDelete: Cascade)
  user        user                    @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([user_id, island_id])
  @@index([created_at])
  @@index([island_id])
  @@index([user_id])
}

model notification {
  id           BigInt            @id @default(autoincrement()) @db.UnsignedBigInt
  user_id      BigInt            @db.UnsignedBigInt
  type         notification_type
  title        String            @db.VarChar(200)
  content      String?           @db.Text
  related_id   BigInt?           @db.UnsignedBigInt
  related_type String?           @db.VarChar(50)
  is_read      Boolean           @default(false)
  created_at   DateTime          @default(now())
  user         user              @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([created_at])
  @@index([is_read])
  @@index([type])
  @@index([user_id])
}

model page_view {
  id            BigInt   @id @default(autoincrement()) @db.UnsignedBigInt
  user_id       BigInt?  @db.UnsignedBigInt
  page_path     String   @db.VarChar(500)
  page_title    String?  @db.VarChar(200)
  device_type   String?  @db.VarChar(50)
  platform      String?  @db.VarChar(50)
  referrer      String?  @db.VarChar(500)
  stay_duration Int?     @db.UnsignedInt
  ip_address    String?  @db.VarChar(50)
  user_agent    String?  @db.VarChar(500)
  created_at    DateTime @default(now())
  user          user?    @relation(fields: [user_id], references: [id])

  @@index([created_at])
  @@index([page_path])
  @@index([platform])
  @@index([user_id])
}

model post {
  id            BigInt          @id @default(autoincrement()) @db.UnsignedBigInt
  user_id       BigInt          @db.UnsignedBigInt
  island_id     BigInt?         @db.UnsignedBigInt
  title         String?         @db.VarChar(200)
  content       String?         @db.Text
  media_type    post_media_type @default(text)
  media_urls    Json?
  like_count    Int             @default(0) @db.UnsignedInt
  comment_count Int             @default(0) @db.UnsignedInt
  collect_count Int             @default(0) @db.UnsignedInt
  view_count    Int             @default(0) @db.UnsignedInt
  share_count   Int             @default(0) @db.UnsignedInt
  status        post_status     @default(active)
  is_top        Boolean         @default(false)
  created_at    DateTime        @default(now())
  updated_at    DateTime
  comment       comment[]
  island        island?         @relation(fields: [island_id], references: [id])
  user          user            @relation(fields: [user_id], references: [id], onDelete: Cascade)
  post_collect  post_collect[]
  post_like     post_like[]

  @@index([created_at])
  @@index([island_id])
  @@index([media_type])
  @@index([status])
  @@index([user_id])
}

model post_collect {
  id         BigInt   @id @default(autoincrement()) @db.UnsignedBigInt
  user_id    BigInt   @db.UnsignedBigInt
  post_id    BigInt   @db.UnsignedBigInt
  created_at DateTime @default(now())
  post       post     @relation(fields: [post_id], references: [id], onDelete: Cascade)
  user       user     @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([user_id, post_id])
  @@index([post_id])
  @@index([user_id])
}

model post_like {
  id         BigInt   @id @default(autoincrement()) @db.UnsignedBigInt
  user_id    BigInt   @db.UnsignedBigInt
  post_id    BigInt   @db.UnsignedBigInt
  created_at DateTime @default(now())
  post       post     @relation(fields: [post_id], references: [id], onDelete: Cascade)
  user       user     @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([user_id, post_id])
  @@index([post_id])
  @@index([user_id])
}

model user {
  id                                                        BigInt                @id @default(autoincrement()) @db.UnsignedBigInt
  username                                                  String                @unique @db.VarChar(50)
  nickname                                                  String                @db.VarChar(50)
  avatar                                                    String?               @db.VarChar(500)
  phone                                                     String?               @unique @db.VarChar(20)
  email                                                     String?               @unique @db.VarChar(100)
  password_hash                                             String                @db.VarChar(255)
  bio                                                       String?               @db.Text
  background_image                                          String?               @db.VarChar(500)
  gender                                                    Int?                  @default(0) @db.TinyInt
  birthday                                                  DateTime?             @db.Date
  role                                                      user_role             @default(user)
  status                                                    user_status           @default(active)
  is_verified                                               Boolean               @default(false)
  coin_balance                                              Decimal               @default(0.00) @db.Decimal(10, 2)
  follow_count                                              Int                   @default(0) @db.UnsignedInt
  follower_count                                            Int                   @default(0) @db.UnsignedInt
  post_count                                                Int                   @default(0) @db.UnsignedInt
  like_count                                                Int                   @default(0) @db.UnsignedInt
  created_at                                                DateTime              @default(now())
  updated_at                                                DateTime
  click_event                                               click_event[]
  coin_transaction                                          coin_transaction[]
  comment                                                   comment[]
  comment_like                                              comment_like[]
  creator_application_creator_application_reviewed_byTouser creator_application[] @relation("creator_application_reviewed_byTouser")
  creator_application_creator_application_user_idTouser     creator_application?  @relation("creator_application_user_idTouser")
  follow_follow_follower_idTouser                           follow[]              @relation("follow_follower_idTouser")
  follow_follow_following_idTouser                          follow[]              @relation("follow_following_idTouser")
  island                                                    island[]
  island_member                                             island_member[]
  notification                                              notification[]
  page_view                                                 page_view[]
  post                                                      post[]
  post_collect                                              post_collect[]
  post_like                                                 post_like[]
  user_behavior                                             user_behavior[]

  @@index([created_at])
  @@index([role])
  @@index([status])
}

model user_behavior {
  id            BigInt   @id @default(autoincrement()) @db.UnsignedBigInt
  user_id       BigInt?  @db.UnsignedBigInt
  behavior_type String   @db.VarChar(50)
  target_type   String   @db.VarChar(50)
  target_id     BigInt   @db.UnsignedBigInt
  page_path     String?  @db.VarChar(500)
  device_info   Json?
  ip_address    String?  @db.VarChar(50)
  created_at    DateTime @default(now())
  user          user?    @relation(fields: [user_id], references: [id])

  @@index([behavior_type])
  @@index([created_at])
  @@index([target_type, target_id])
  @@index([user_id])
}

enum coin_transaction_type {
  recharge
  consume
  reward
  refund
}

enum notification_type {
  system
  interaction
  payment
}

enum island_member_join_type {
  free
  paid
}

enum post_media_type {
  text
  image
  video
  mixed
}

enum comment_status {
  active
  banned
  deleted
}

enum creator_application_status {
  pending
  approved
  rejected
}

enum island_status {
  pending
  active
  banned
  deleted
}

enum user_role {
  user
  creator
  admin
}

enum post_status {
  active
  pending
  banned
  deleted
}

enum user_status {
  active
  banned
  deleted
}
